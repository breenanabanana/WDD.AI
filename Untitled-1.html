<!DOCTYPE html>
<html lang="en">
<<<<<<< HEAD
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>Summer Camp WDD Using AI</title>
    <style>
      body {
            background-color: #ffffff;
            background-repeat: no-repeat;
        }
        main div {
            border: 1px solid black;
            padding: 10px;
            margin: 10px 0;
        }
        #div1 img {
            width: 400px;
            height: 300px;
        }
        
        footer {
            padding-top: 30px;
            padding-bottom: 20px;
            text-align: center;
        }
        .banner {
      background-color: #f7f7f7;
      text-align: center;
      padding: 20px;
    }
    </style>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script><style id="plotly.js-style-global"></style>
<style>
      body.shimeji-pinned iframe {
        pointer-events: none;
      }
      body.shimeji-select-ie {
        cursor: cell !important;
      }
      #shimeji-contextMenu::-webkit-scrollbar {
        width: 6px;
      }
      #shimeji-contextMenu::-webkit-scrollbar-thumb {
        background-color: rgba(30,30,30,0.6);
        border-radius: 3px;
      }
      #shimeji-contextMenu::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style><meta name="shimejiBrowserExtensionId" content="gohjpllcolmccldfdggmamodembldgpc" data-version="2.0.5"></head>
  <body>
    <div class="container">
        <div class="banner">
            <h1>Summer Camp WDD Using AI</h1>
        </div>
        <main>
            <div id="div1">
                <h2>Section 1. What is a linear regression?</h2>
                <ul>
                    <li>It tries to find a linear function y=wx+b</li>
                    <li>The linear function tries to fit a collection of number pairs, such as house sales, (sqft, sale price)</li>
                    <li>There is no linear function that can accurately fit all number pairs. So, we have to find the 'best' one.</li>
                    <li>By being best, we design a so-called cost function, such as mean square error invented by the great Carl Gauss.</li>
                    <li>This is what machine learning is doing.
                        <br><img src="https://backupspirit.com/camp/AI/linearRegression1.jpg" alt="Linear Regression Image"></li>
                </ul>
            </div>

            <div id="div2">
                <h2>Section 2. The javascript libraries to use</h2>
                <p>We will use TensorFlow.js to train the model.</p>
                <p>Click the 'Run' button below to import two JavaScript libraries.</p>
            </div>
            
            <div id="div3">
              <p>Import <a href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js">https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js</a> for defining and training models.</p>
              <p>Import <a href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js">https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js</a> for web browser visualization.</p>
              <button onclick="loadLibraries()">Run</button>
          </div>

            <div id="div4">Libraries loaded: @tensorflow/tfjs@1.0.0, @tensorflow/tfjs-vis@1.0.2</div>




            <div id="div5">
                
                <h2>Section 3. Using the dataset from Google </h2>
                <p>We will use a dataset from Google, <a href="https://storage.googleapis.com/tfjs-tutorials/carsData.json">https://storage.googleapis.com/tfjs-tutorials/carsData.json</a></p>
                <button onclick="loadDataset()">Load the dataset</button>
            </div>
        
            <div id="div6">
                Output: 
                <!-- Console output will be displayed here -->
            </div>
        
            <div id="div7">
                <h2>Section 4. Extract the Miles_per_Gallon and Horsepower</h2>
                <p>We will use only Miles_per_gallon:value and Horsepower:value for our training.</p>
                <button onclick="extractAndDisplay()">Extract training dataset</button>
                <div id="extractedDataDisplay"></div>
            </div>


            <div id="div8">
                <h2> Section 5. Visualize the training dataset</h2>
                <button onclick="visualizeDataset()">Visualize the training dataset</button>
                <div id="plot"></div>
            </div>


            <div id="div9" style="background-color: black; color:red">
                <h2>Section 6. Define the model</h2>
                <p>We will define a TensorFlow sequential model with one input x and one output y.</p>
                <button onclick="defineModel()">Define a model</button>
            </div>

            <div id="div10">
                <button onclick="showModelSummary()">Show summary of the model</button>
                <div id="modelSummary"></div>
            </div>


            <div id="div11">
                <h2>Section 7. Prepare the training set</h2>
                <p>We will prepare the extracted data.</p>
                <ul>
                    <li>Convert the extracted data to Tensor</li>
                    <li>Shuffle the data</li>
                    <li>Normalize to the range between 0 and 1 for fast computation</li>
                </ul>
                <button onclick="prepareDataset()">Prepare the dataset</button>
            </div>




            <div id="div12">
                <h2>Section 8. Visualize the inputs and labels for training</h2>
                <button onclick="visualizeInputsAndLabels()">Visualize the inputs and labels</button>
            </div>


            <div id="div13">
                <h2>Section 9. Train the model</h2>
                <button onclick="trainModel()">Train the model using prepared data</button>
            </div>
        


            <div id="div14">
                <h2> Section 10. Generate the dataset for testing</h2>
                <button onclick="generateTestData()">Generate a test data values</button>
            </div>



            <div id="div15">
                <h2>Section 11. Visualize the predictions</h2>
                <button onclick="visualizePredictions()">Visualize the predictions</button>
            </div>


            <!-- Other div elements -->
        </main>
    </div>

    <script>
        function loadLibraries() {
            var script1 = document.createElement('script');
            script1.src = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js';
            document.head.appendChild(script1);

            var script2 = document.createElement('script');
            script2.src = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js';
            document.head.appendChild(script2);

            // Display console output
            var consoleOutput = "Libraries loaded: @tensorflow/tfjs@1.0.0, @tensorflow/tfjs-vis@1.0.2";
            document.getElementById('div4').innerText = consoleOutput;
        }
    </script>
    
    <script>
        let globalDataset; // Global variable to store the dataset
        let extractedData; // Global variable to store the extracted dataset

        function loadDataset() {
            fetch('https://storage.googleapis.com/tfjs-tutorials/carsData.json')
                .then(response => response.json())
                .then(data => {
                    globalDataset = data; // Save the dataset to the global variable
                    console.log('Dataset loaded:', data);
                    const firstTenValues = globalDataset.slice(0, 10); // Get the first 10 data values
                    document.getElementById('div6').innerText = 'First 10 data values: ' + JSON.stringify(firstTenValues);            })
            .catch(error => console.error('Error loading dataset:', error));
        }
        function extractData() {
            extractedData = globalDataset.map(item => {
                return {
                    Miles_per_Gallon: item.Miles_per_Gallon,
                    Horsepower: item.Horsepower
                };
            });
            console.log('Extracted data:', extractedData);
        }


        function extractAndDisplay() {
            extractData();
            const firstTenExtractedValues = extractedData.slice(0, 10); // Get the first 10 extracted data values
            document.getElementById('extractedDataDisplay').innerText = 'First 10 extracted data values: ' + JSON.stringify(firstTenExtractedValues);
        }
    </script>


    <script>
      function visualizeDataset() {
        const horsepowerValues = extractedData.map(item => item.Horsepower);
        const mpgValues = extractedData.map(item => item.Miles_per_Gallon);

        const trace = {
            x: horsepowerValues,
            y: mpgValues,
            mode: 'markers',
            type: 'scatter'
        };

        const layout = {
            title: 'Horsepower vs Miles_per_Gallon',
            xaxis: {
                title: 'Horsepower',
                range: [0, 240],
                dtick: 20
            },
            yaxis: {
                title: 'MPG',
                range: [0, 50],
                dtick: 10
            }
        };

        Plotly.newPlot('plot', [trace], layout);
      }
    </script>

    <script>
        let model;

        function defineModel() {
            model = tf.sequential();
            model.add(tf.layers.dense({inputShape: [1], units: 1}));
            model.add(tf.layers.dense({units: 1}));
            console.log('Sequential model defined');
        }
        //const model = tf.sequential();
        //model.add(tf.layers.dense({inputShape: [1], units: 1}));
        //model.add(tf.layers.dense({units: 1}));

    </script>

    <script>
        function showModelSummary() {
            //Not work
            //const modelSummary = model.summary();
            //console.log(modelSummary);
            //document.getElementById('modelSummary').innerText = modelSummary;

            //Way 1
            //tfvis.show.modelSummary({name: 'Model Summary'}, model);

            //Way 2
            const container = document.getElementById('modelSummary');
            tfvis.show.modelSummary(container, model);    

        }
    </script>


<script>
    // Declare model as a global variable

    let preparedData;

    function prepareDataset() {
        /*
        // Convert the extracted data to a TensorFlow tensor
        preparedData = tf.tensor2d(extractedData);

        // Shuffle the data
        preparedData = preparedData.shuffle(100);

        // Normalize to the range between 0 and 1 for fast computation
        const min = preparedData.min();
        const max = preparedData.max();
        preparedData = preparedData.sub(min).div(max.sub(min));

        console.log('Dataset prepared:', preparedData);
        */



            // Extract horsepower as inputs and mpg as labels
            const inputs = extractedData.map(item => item.Horsepower);
            const labels = extractedData.map(item => item.Miles_per_Gallon);

            /*
            // Convert inputs and labels to TensorFlow tensors
            const inputTensor = tf.tensor2d(inputs);
            const labelTensor = tf.tensor2d(labels);
            */

            // Convert inputs and labels to TensorFlow tensors with shape [*, 1]
            const inputTensor = tf.tensor2d(inputs, [inputs.length, 1]);
            const labelTensor = tf.tensor2d(labels, [labels.length, 1]);

            // Normalize inputs and labels
            const inputMax = inputTensor.max();
            const inputMin = inputTensor.min();
            const labelMax = labelTensor.max();
            const labelMin = labelTensor.min();

            const normalizedInputs = inputTensor.sub(inputMin).div(inputMax.sub(inputMin));
            const normalizedLabels = labelTensor.sub(labelMin).div(labelMax.sub(labelMin));

            /*
            // Return the object containing the normalized tensors and the maximum and minimum values
            return {
                inputs: normalizedInputs,
                labels: normalizedLabels,
                inputMax: inputMax,
                inputMin: inputMin,
                labelMax: labelMax,
                labelMin: labelMin
            };
            */

            preparedData = {
                inputs: normalizedInputs,
                labels: normalizedLabels,
                inputMax: inputMax,
                inputMin: inputMin,
                labelMax: labelMax,
                labelMin: labelMin
            };
    }
</script>

<script>
           function visualizeInputsAndLabels() {
            const inputValues = preparedData.inputs.dataSync();
            const labelValues = preparedData.labels.dataSync();

            const data = { values: [] };
            for (let i = 0; i < inputValues.length; i++) {
                data.values.push({ x: inputValues[i], y: labelValues[i] });
            }

            const surface = { name: 'Inputs vs Labels', tab: 'Scatter Plot' };
            const plotData = { values: data.values, tab: 'Scatter Plot' };
            tfvis.render.scatterplot(
                div12, plotData, {
                    xLabel: 'Inputs',
                    yLabel: 'Labels',
                    height: 300,
                    fontSize: 12
                }
            );
        }
</script>


    <script>
        async function trainModel() {
            // Define the loss, optimizer, and metrics
            const loss = 'meanSquaredError';
            const optimizer = tf.train.adam();
            const metrics = ['mse'];

            // Train the model using prepared data
            await model.compile({ loss, optimizer, metrics });
            const history = await model.fit(preparedData.inputs, preparedData.labels, {
                batchSize: 32,
                epochs: 50,
                /*
                callbacks: tfvis.show.fitCallbacks(
                    { name: 'Training Performance', tab: 'Training Performance' },
                    ['loss', 'mse'],
                    { height: 200 }
                )
                */
                callbacks: tfvis.show.fitCallbacks(
                    div13, ['loss', 'mse'],
                    { name: 'Training Performance', tab: 'Training Performance', height: 200 }
                )

            });
        }
    </script>


<script>
    let testDataInputs = [];
    let testDataPredictions = [];

    function generateTestData() {
        // Define the number of features
        const numFeatures = 1;

        // Generate uniform range of numbers between 0 and 1 for inputs
        const numInputs = 100;
        const inputs = tf.randomUniform([numInputs, numFeatures]);

        // Use the trained model to predict the results
        const predictions = model.predict(inputs);

        // Un-normalize the data by doing the inverse of the min-max scaling
        /*
        const unnormalizedInputs = inputs.mul(inputMax.sub(inputMin)).add(inputMin);
        const unnormalizedPredictions = predictions.mul(outputMax.sub(outputMin)).add(outputMin);
        */
        const unnormalizedInputs = inputs.mul(preparedData.inputMax.sub(preparedData.inputMin)).add(preparedData.inputMin);
        const unnormalizedPredictions = predictions.mul(preparedData.labelMax.sub(preparedData.labelMin)).add(preparedData.labelMin);



        // Save the un-normalized inputs and predictions to global variables
        testDataInputs = unnormalizedInputs.arraySync();
        testDataPredictions = unnormalizedPredictions.arraySync();
    }
</script>

<script>
        function visualizePredictions() {

            /* not from AI --- start*/
            const predictedPoints = Array.from(testDataInputs).map((val, i) => {
                return {x: val, y: testDataPredictions[i]}
            });

            const originalPoints = extractedData.map(d => ({
                x: d.Horsepower, y: d.Miles_per_Gallon,
            }));
            /* not from AI --- start*/

            const data = {
                values: [originalPoints, predictedPoints],
                //values: [extractedData, testDataInputs],
                series: ['Extracted Data', 'Test Data Predictions'],
            };
            const surface = tfvis.render.scatterplot(
                div15, data, {xLabel: 'X', yLabel: 'Y', height: 300, series: ['Extracted Data', 'Test Data Predictions']}
            );
        }


        function visualizePredictions2() {
            const data = [
                {x: extractedData, y: extractedLabels, name: 'Extracted Data', mode: 'markers', type: 'scatter'},
                {x: testDataInputs, y: testDataPredictions, name: 'Test Data Predictions', mode: 'markers', type: 'scatter'}
            ];
            const layout = {
                xaxis: {title: 'Input Data'},
                yaxis: {title: 'Predicted Data'}
            };
            Plotly.newPlot('div15', data, layout);
        }
</script>


<footer>
    <p>Copyright@2024, Albany State University Summer Camp 'Web Design and Development Using AI'</p>
    <p>Reference: <a href="https://codelabs.developers.google.com/codelabs/tfjs-training-regression/index.html#6">
        https://codelabs.developers.google.com/codelabs/tfjs-training-regression/index.html#6
    </a></p>
</footer>


<div id="shimeji-workArea" style="position: fixed; background: transparent; z-index: 2147483643; width: 100vw; height: 100vh; left: 0px; top: 0px; transform: translate(0px, 0px); pointer-events: none;"></div></body>  
=======
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Summer CAM WDD Using AI</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .banner {
      background-color: silver;
      text-align: center;
      padding: 20px;
    }
    main div {
      border-bottom: 1px solid #000;
      padding-bottom: 20px;
      margin-bottom: 20px;
    }

  </style>
  <script src="data.js"></script>
</head>
<body>
  <div class="banner">
    <h1>Summer CAM WDD Using AI</h1>
  </div>

  <main>
    <!-- 20 div elements with unique IDs -->
    <div id="div1">
        <h2>Section 1. What is a convolutional neural network?</h2>
        <ul>
          <li>It tries to find an edge or pattern in an image</li>
          <li>It usually consists of one or more convolution plus pooling layer, and one fully connected (FC) layer</li>
          <li>When doing convolution on an image, we use a 5x5 filter. Further, we may apply several such filters to detect edge/pattern along several lines</li>
          <li>The cost function will be</li>
          <li>The last layer is output lay where we use a so-called Sigmoid activation, so that several outputs can be used.
            <br>
            <img src="https://www.backupspirit.com/camp/AI/convolutionExample3.jpg" alt="Convolution Example" style="width: 600px; height: 300px;">        </ul>
    </div>

    <div id="div2">
      <h2>Section 2. Load TensorFlow for Java Script libraries </h2>
      <p>We will use TensorFlow.js to train the model.</p>
      <p>Click the 'Run' button below to import two JavaScript libraries.</p>
      <p> import https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js for defining and training models.</p>
      <p> import https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js for web browser visualization.</p> 

      <button onclick="loadLibraries()">Run</button>
    </div>

    <div id="div3">Output:  </div>


    <div id="div4">
      <h2>Section 3. The dataset of images</h2>
      <p>We will use a dataset from Google, https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png, 
         and their labels, https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"</p>. 
      <p>The dataset is a big image file. It contains 65,000 images, each of size 28 x 28 x 1. The label file contains 65,000 labels. 
         Each image use 10 numbers to indicate which digit the image represent.”</p>


    </div>

    <div id="div5">
      <h2>Section 4. The JavaScript module to process the dataset</h2>
      <p> We will use a JavaScript class from ‘./data.js’ to process the dataset. Please download
        <a href="data.js">data.js</a> and save it to the same folder where your model is.
      </p>
      
      <button onclick="loadDataset()">Load the dataset</button>
    </div>

    <div id="div6">Output: </div>

    <div id="div7">
      <h2>Section 5 We will show 20 images from the dataset</h2>
      <button id="showImagesButton">Show the first 20 images</button>

    </div>


    <div id="div8">
      <h2>Section 6. Define a CNN.</h2>
      <p>Our CNN has input of shape 28 x 28 x 1.</p>
      <p>The first layer is a convolution + pooling. We will use 8 filters, each filter has kernel size=5 x 5 and stride =1. The activation function is ‘relu’. We use the max pooling of size 2 x 2 with stride=[2,2].</p>
      <p>The second layer is also a convolution + pooling. This time, we use 16 filters each of kernel size=5x5 and stride =1. The activation function is also ‘relu’. We use the max pooling of size 2 x 2 with stride=[2,2].</p>
      <p>The third layer is a fully connected layer with shape * x 1.</p>
      <p>The last layer is the output layer, with 10 outputs representing 10 digits. The activation function is now ‘softmax’.</p>
      <button onclick="defineModel()">Define the model</button>
    </div>




    <div id="div9">Output: </div>

    <div id="div10">
      <h2>Section 7. Train the model using 5000 images</h2>
      <p>The batch size = 512, and epochs = 10</p>
      <p>The test size = 1000</p>
      <p>The callbacks have name='Model Training', tab='Model', styles='{height: 1000px}', metrics={'loss', 'val_loss', 'acc', 'val_acc'}</p>
      <button onclick="trainModel()">Train the model</button>
    </div>



    <div id="div11">Output: </div>


    <div id="div12">
      <h2>Evaluate the model</h2>
      <p>We will obtain 500 images from the dataset mnistData.</p>
      <p>We use the trained model to calculate the predictions and then compare the predictions with the provided labels.</p>
      <p>We then draw a confusion matrix to show for each digit, how many images are labeled for that digit and how many images that predicted to that digit. Further, how many differences.</p>
      <!-- You can add the confusion matrix visualization here -->

<!--      <button onclick="showConfusionMatrix()">Show a confusion matrix</button>
-->
      <button onclick="showConfusion(globalModel, mnistData)">Show the confusion matrix</button>
    </div>
    <div id="div13">Output: </div>



   
  </main>

  <!-- Bootstrap JS and Popper.js -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>


  <script>
    function loadLibraries() {
      var script1 = document.createElement('script');
      script1.src = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js';
      document.body.appendChild(script1);

      var script2 = document.createElement('script');
      script2.src = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js';
      document.body.appendChild(script2);

      console.log('Libraries loaded successfully.');
      document.getElementById('div3').innerText += ' Libraries loaded successfully.';
    }
  </script>
  
  <script>
    let mnistData;
    async function loadDataset() {
      try {
        mnistData = new MnistData();
        await mnistData.load();
        displayDatasetShape(mnistData);


        //console.log('Dataset and labels loaded successfully');
      } catch (error) {
        console.error('Error loading dataset and labels:', error);
      }
    }
    function displayDatasetShape(data) {
      const images = data.trainImages;
      const labels = data.trainLabels;
      const imagesShape = images.length;
      const labelsShape = labels.length;
      document.getElementById('div6').innerText = `Images shape: ${imagesShape}, Labels shape: ${labelsShape}`; 
    }
   
  </script>

  <script>
      document.getElementById('showImagesButton').addEventListener('click', function() {
         showFirst20Images(mnistData);
      });

 
    /*
    async function showFirst20Images(data) {
      const surface = tfvis.visor().surface({ name: 'First 20 Images' });
      const batchSize = 20;
      //const [images, labels] = data.nextBatch(batchSize);

      const images = data.nextTestBatch(batchSize);
      for (let i = 0; i < batchSize; i++) {
        const imageTensor = tf.tidy(() => {
          return images.xs.slice([i, 0], [1, images.xs.shape[1]]).reshape([28, 28, 1]);
        });
       // const label = labels[i];

        const canvas = document.createElement('canvas');
        canvas.width = 28;
        canvas.height = 28;
        canvas.style = 'margin: 4px;';
        const imageElement = await tf.browser.toPixels(imageTensor, canvas);
       // tfvis.render.image(surface, {tensor: imageElement, labels: [label]});

       surface.drawArea.appendChild(canvas);

       imageTensor.dispose();
      }
    }
    */

    async function showFirst20Images(mnistData) {
  
      const examples = mnistData.nextTestBatch(20); // Obtain 20 images from mnistData
      const surfaceElement = document.getElementById('div7'); // Get the surface element by its ID

      const images = examples.xs;
      for (let i = 0; i < 20; i++) {
        const imageTensor = images.slice([i, 0], [1, 784]).reshape([28,28,1]); // Extract the image tensor
        // const imageDataArray = imageTensor.reshape([28,28,1]); // Convert the tensor to a regular array

        const imageElement = document.createElement('canvas'); // Create a canvas element
        imageElement.width = 28;
        imageElement.height = 28;
        const ctx = imageElement.getContext('2d');
        const imageData = ctx.createImageData(28, 28); // Create an ImageData object

        await tf.browser.toPixels(imageTensor, imageElement);
        //for (let j = 0; j < imageDataArray.length; j++) {
        //  imageData.data[j] = imageDataArray[j]; // Set the pixel data for the image
        //}

        // ctx.putImageData(imageData, 0, 0); // Draw the image data onto the canvas

        surfaceElement.appendChild(imageElement); // Add the canvas element to the surface
  
        const label=examples.labels.slice([i,0], [1, 10]);
        const labelDiv = document.createElement('div');
        labelDiv.textContent = `Label: ${label}`;
        surfaceElement.appendChild(labelDiv);
  }
}

    
  </script>
  

  <script>
    let globalModel; // Define a global variable to store the model

    async function defineModel() {
      const model = tf.sequential();
      model.add(tf.layers.conv2d({
        inputShape: [28, 28, 1],
        filters: 8,
        kernelSize: 5,
        strides: 1,
        activation: 'relu',
        kernelInitializer: 'varianceScaling'
      }));
      model.add(tf.layers.maxPooling2d({poolSize: [2, 2], strides: [2, 2]}));
      model.add(tf.layers.conv2d({
        filters: 16,
        kernelSize: 5,
        strides: 1,
        activation: 'relu',
        kernelInitializer: 'varianceScaling'
      }));
      model.add(tf.layers.maxPooling2d({poolSize: [2, 2], strides: [2, 2]}));
      model.add(tf.layers.flatten());
      model.add(tf.layers.dense({
        units: 10,
        kernelInitializer: 'varianceScaling',
        activation: 'softmax'
      }));


      const optimizer = 'adam';
      const loss = 'categoricalCrossentropy';
      const metrics = ['accuracy'];

      model.compile({
        optimizer: optimizer,
        loss: loss,
        metrics: metrics
      });


      await model.build();
      const summaryElement = document.getElementById('div9');
      //const tfvis = require('@tensorflow/tfjs-vis');
      tfvis.show.modelSummary(summaryElement, model);

      globalModel =  model
  }


  </script>



<script>
   /*
  async function trainModel() {
   
    const numTrainExamples = 5000;
    const numTestExamples = 1000;

    const trainExamples = mnistData.nextTrainBatch(numTrainExamples);
    const testExamples  = mnistData.nextTestBatch(numTestExamples);

    const xTrain = trainExamples.xs.reshape([numTrainExamples, 28, 28, 1]);
    const yTrain = trainExamples.labels;
    const xTest  = testExamples.xs.reshape([numTestExamples, 28, 28,1]);
    const yTest  = testExamples.labels;

    const optimizer = 'adam';
    const loss = 'categoricalCrossentropy';
    const metrics = ['loss', 'val_loss', 'acc', 'val_acc'];

    const metric = ['accuracy'];

      globalModel.compile({
        optimizer: optimizer,
        loss: loss,
        metrics: metric
      });

    await globalModel.fit(xTrain, yTrain, {
      batchSize: 512,
      epochs: 10,
      validationData: [xTest, yTest],
      callbacks: tfvis.show.fitCallbacks(
        { name: 'Model Training', tab: 'Model', styles: { height: 1000 } },
        metrics
      )
    });
  }
*/



  async function trainModel() {
    // Compile the globalModel
    globalModel.compile({
      optimizer: 'adam',
    loss: 'categoricalCrossentropy',
    metrics: ['accuracy']
  });

  // Obtain a batch of 5000 training examples
  const trainData = mnistData.nextTrainBatch(5000);
  const trainImages = trainData.xs.reshape([5000, 28, 28, 1]);
  const trainLabels = trainData.labels;

  // Obtain a batch of 1000 testing examples
  const testData = mnistData.nextTestBatch(1000);
  const testImages = testData.xs.reshape([1000, 28, 28, 1]);
  const testLabels = testData.labels;


//  const fitCallbacks = tfvis.show.fitCallbacks(document.getElementById('div11'), 
//     ['loss', 'acc'],
//      {height: 400});

  // Train the model
  const history = await globalModel.fit(trainImages, trainLabels, {
    batchSize: 512,
    epochs: 10,
    validationData: [testImages, testLabels],

    callbacks: tfvis.show.fitCallbacks(
      document.getElementById('div11'),
      //{ name: 'Model Training', tab: 'Model' },
      ['loss', 'acc'],
      { height: 400 }
    )
    
    //callbacks: fitCallbacks
  });


    // Display the training history
    //tfvis.show.history(document.getElementById('div11'), history);

}
</script>

<script>
  /*
  async function showConfusionMatrix() {
    const numExamples = 500;
    const examples = mnistData.nextTestBatch(numExamples);
    const xTest = examples.xs.reshape([numExamples, 28, 28, 1]);
    const yTest = examples.labels.argMax(-1);

    const predictions = globalModel.predict(xTest).argMax(-1);

    const perClassAccuracy = tfvis.metrics.perClassAccuracy(yTest, predictions);
    const confusionMatrix = tfvis.metrics.confusionMatrix(yTest, predictions);

    const confusionMatrixContainer = document.getElementById('confusionMatrixVisualization');
    await tfvis.render.confusionMatrix(confusionMatrixContainer, { values: confusionMatrix, tickLabels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'] });
  }
  */
</script>

<script>

const classNames = ['Zero', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];

function doPrediction(model, data, testDataSize = 500) {
  const IMAGE_WIDTH = 28;
  const IMAGE_HEIGHT = 28;
  const testData = data.nextTestBatch(testDataSize);
  const testxs = testData.xs.reshape([testDataSize, IMAGE_WIDTH, IMAGE_HEIGHT, 1]);
  const labels = testData.labels.argMax(-1);
  const preds = model.predict(testxs).argMax(-1);

  testxs.dispose();
  return [preds, labels];
}

/*
async function showAccuracy1(model, data) {
  const [preds, labels] = doPrediction(model, data);
  const classAccuracy = await tfvis.metrics.perClassAccuracy(labels, preds);
  const container = {name: 'Accuracy', tab: 'Evaluation'};
  tfvis.show.perClassAccuracy(container, classAccuracy, classNames);

  labels.dispose();
}

async function showConfusion1(model, data) {
  const [preds, labels] = doPrediction(model, data);
  const confusionMatrix = await tfvis.metrics.confusionMatrix(labels, preds);
  const container = {name: 'Confusion Matrix', tab: 'Evaluation'};
  tfvis.render.confusionMatrix(container, {values: confusionMatrix, tickLabels: classNames});

  labels.dispose();
}

async function showAccuracy(model, data) {
  const [preds, labels] = doPrediction(model, data);
  const classAccuracy = await tfvis.metrics.perClassAccuracy(labels, preds);
  const container = {name: 'Accuracy', tab: 'Evaluation'};
  tfvis.show.perClassAccuracy(container, classAccuracy, classNames);

  labels.dispose()
}
*/

async function showConfusion(model, data) {
  const [preds, labels] = doPrediction(model, data);
  const confusionMatrix = await tfvis.metrics.confusionMatrix(labels, preds);
  //const container = {name: 'Confusion Matrix', tab: 'Evaluation'};
  const container = document.getElementById('div13');
  tfvis.render.confusionMatrix(container, {values: confusionMatrix, tickLabels: classNames});

  labels.dispose();
}



</script>


</body>
>>>>>>> 028adb23449d49d9069dc4d1f601a273dc3b901d
</html>